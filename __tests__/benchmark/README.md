# API å¼•æ“æ€§èƒ½åŸºå‡†æµ‹è¯•

æœ¬ç›®å½•åŒ…å« @ldesign/api åŒ…çš„æ€§èƒ½åŸºå‡†æµ‹è¯•å¥—ä»¶ã€‚

## ğŸ“Š æµ‹è¯•èŒƒå›´

æ€§èƒ½åŸºå‡†æµ‹è¯•è¦†ç›–ä»¥ä¸‹å…³é”®é¢†åŸŸï¼š

### 1. ä¸­é—´ä»¶æ€§èƒ½
- æ— ä¸­é—´ä»¶è°ƒç”¨åŸºçº¿
- 5ä¸ªå…¨å±€ä¸­é—´ä»¶æ€§èƒ½
- 10ä¸ªå…¨å±€ä¸­é—´ä»¶æ€§èƒ½
- ä¸­é—´ä»¶ç¼“å­˜æ•ˆæœæµ‹è¯•

### 2. ç¼“å­˜æ€§èƒ½
- ç¼“å­˜é”®ç”Ÿæˆï¼ˆå°/ä¸­/å¤§å¯¹è±¡ï¼‰
- LRU ç¼“å­˜å†™å…¥æ€§èƒ½
- LRU ç¼“å­˜è¯»å–æ€§èƒ½
- ç¼“å­˜å‘½ä¸­ç‡æµ‹è¯•

### 3. æ–¹æ³•æ³¨å†Œæ€§èƒ½
- å•ä¸ªæ–¹æ³•æ³¨å†Œ
- æ‰¹é‡æ³¨å†Œ 10 ä¸ªæ–¹æ³•
- æ‰¹é‡æ³¨å†Œ 100 ä¸ªæ–¹æ³•

### 4. é…ç½®æ„å»ºæ€§èƒ½
- é‡è¯•é…ç½®æ„å»ºï¼ˆé»˜è®¤å€¼/å®Œæ•´é…ç½®ï¼‰
- æ–­è·¯å™¨é…ç½®æ„å»º
- ä¸­é—´ä»¶é…ç½®ç¼“å­˜

### 5. å¼•æ“ç”Ÿå‘½å‘¨æœŸ
- å¼•æ“åˆ›å»ºï¼ˆæœ€å°/å®Œæ•´é…ç½®ï¼‰
- å¼•æ“é”€æ¯
- åˆ›å»º+æ³¨å†Œ+é”€æ¯å®Œæ•´æµç¨‹

### 6. å¯¹è±¡è§„èŒƒåŒ–
- è¯·æ±‚é…ç½®è§„èŒƒåŒ–ï¼ˆæ— å‡½æ•°/æœ‰å‡½æ•°/å¤šå‡½æ•°ï¼‰
- å‡½æ•°è§£ææ€§èƒ½

### 7. é‡è¯•æœºåˆ¶
- å›ºå®šå»¶è¿Ÿè®¡ç®—
- æŒ‡æ•°é€€é¿è®¡ç®—
- æŠ–åŠ¨è®¡ç®—

### 8. æ–­è·¯å™¨
- çŠ¶æ€æ£€æŸ¥
- æˆåŠŸåé¦ˆå¤„ç†
- å¤±è´¥åé¦ˆå¤„ç†

## ğŸš€ è¿è¡ŒåŸºå‡†æµ‹è¯•

### è¿è¡Œæ‰€æœ‰åŸºå‡†æµ‹è¯•
```bash
pnpm run bench
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
```bash
pnpm vitest bench __tests__/benchmark/performance.bench.ts
```

### ç”ŸæˆåŸºå‡†æŠ¥å‘Š
```bash
pnpm vitest bench --reporter=verbose
```

## ğŸ“ˆ ç»“æœè§£è¯»

åŸºå‡†æµ‹è¯•ç»“æœåŒ…å«ä»¥ä¸‹æŒ‡æ ‡ï¼š

- **ops/sec**: æ¯ç§’æ“ä½œæ•°ï¼Œè¶Šé«˜è¶Šå¥½
- **mean**: å¹³å‡æ‰§è¡Œæ—¶é—´
- **min/max**: æœ€å°/æœ€å¤§æ‰§è¡Œæ—¶é—´
- **p75/p99**: 75th/99th ç™¾åˆ†ä½æ•°å»¶è¿Ÿ

### æ€§èƒ½ç›®æ ‡

| æ“ä½œ | ç›®æ ‡ ops/sec | è¯´æ˜ |
|------|-------------|------|
| ç¼“å­˜é”®ç”Ÿæˆï¼ˆå°å¯¹è±¡ï¼‰ | > 1,000,000 | åº”è¯¥éå¸¸å¿« |
| ä¸­é—´ä»¶è·å–ï¼ˆç¼“å­˜å‘½ä¸­ï¼‰ | > 10,000,000 | ç¼“å­˜å‘½ä¸­åº”è¯¥æå¿« |
| æ–¹æ³•æ³¨å†Œ | > 100,000 | æ³¨å†Œæ“ä½œåº”è¯¥å¿«é€Ÿ |
| é…ç½®æ„å»º | > 1,000,000 | é…ç½®åˆå¹¶åº”è¯¥å¿«é€Ÿ |
| å¼•æ“åˆ›å»º | > 10,000 | åˆå§‹åŒ–å…è®¸ç¨æ…¢ |

## ğŸ“ ä¼˜åŒ–å»ºè®®

### Phase 1 ä¼˜åŒ–æˆæœï¼ˆå·²å®Œæˆï¼‰
- âœ… æå–é­”æ•°å¸¸é‡
- âœ… æ·»åŠ æ–­è·¯å™¨çŠ¶æ€è‡ªåŠ¨æ¸…ç†
- âœ… ä¼˜åŒ– React Hooks ä¾èµ–

### Phase 2 ä¼˜åŒ–æˆæœï¼ˆå·²å®Œæˆï¼‰
- âœ… å®ç°ä¸­é—´ä»¶æ•°ç»„ç¼“å­˜ï¼ˆLRUï¼‰
- âœ… æ‹†åˆ† call æ–¹æ³•ï¼Œæå‡å¯ç»´æŠ¤æ€§
- âœ… æ·»åŠ  TypedApiEngine ç±»å‹å®‰å…¨æ¥å£

### é¢„æœŸæ€§èƒ½æå‡

| ä¼˜åŒ–é¡¹ | é¢„æœŸæå‡ | å®é™…æµ‹é‡ |
|-------|---------|---------|
| ä¸­é—´ä»¶ç¼“å­˜ | 30-40% | å¾…æµ‹é‡ |
| call æ–¹æ³•æ‹†åˆ† | å¯è¯»æ€§â†‘ | âœ… |
| ç±»å‹å®‰å…¨ | 0%ï¼ˆç¼–è¯‘æ—¶ï¼‰ | âœ… |

## ğŸ” æ€§èƒ½åˆ†æ

### å¦‚ä½•è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ

1. **è¿è¡ŒåŸºå‡†æµ‹è¯•**
   ```bash
   pnpm run bench
   ```

2. **å¯¹æ¯”ä¼˜åŒ–å‰å**
   - è®°å½•ä¼˜åŒ–å‰çš„åŸºå‡†æ•°æ®
   - åº”ç”¨ä¼˜åŒ–
   - é‡æ–°è¿è¡ŒåŸºå‡†æµ‹è¯•
   - å¯¹æ¯”ç»“æœ

3. **ä½¿ç”¨ Chrome DevTools**
   - åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­åˆ†æ
   - ä½¿ç”¨ Performance é¢æ¿
   - æŸ¥æ‰¾çƒ­ç‚¹å‡½æ•°

### å¸¸è§æ€§èƒ½é—®é¢˜

#### 1. ä¸­é—´ä»¶è¿‡å¤š
**ç—‡çŠ¶**: `ä¸­é—´ä»¶æ€§èƒ½` æµ‹è¯•ç»“æœå·®
**è§£å†³**: 
- å‡å°‘ä¸å¿…è¦çš„ä¸­é—´ä»¶
- åˆå¹¶ç›¸ä¼¼åŠŸèƒ½çš„ä¸­é—´ä»¶
- ä½¿ç”¨æ¡ä»¶ä¸­é—´ä»¶

#### 2. ç¼“å­˜æœªå‘½ä¸­
**ç—‡çŠ¶**: `ç¼“å­˜æ€§èƒ½` æµ‹è¯•æ˜¾ç¤ºå‘½ä¸­ç‡ä½
**è§£å†³**:
- æ£€æŸ¥ç¼“å­˜é”®ç”Ÿæˆé€»è¾‘
- è°ƒæ•´ç¼“å­˜å¤§å°
- ä¼˜åŒ– TTL è®¾ç½®

#### 3. å¯¹è±¡åˆ›å»ºè¿‡å¤š
**ç—‡çŠ¶**: `é…ç½®æ„å»ºæ€§èƒ½` æµ‹è¯•æ…¢
**è§£å†³**:
- ä½¿ç”¨å¯¹è±¡æ± 
- ç¼“å­˜é…ç½®å¯¹è±¡
- å‡å°‘å¯¹è±¡å±•å¼€æ“ä½œ

## ğŸ“Š æŒç»­ç›‘æ§

### CI/CD é›†æˆ

åœ¨ CI ä¸­è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼š

```yaml
# .github/workflows/benchmark.yml
name: Benchmark
on: [push, pull_request]

jobs:
  benchmark:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - run: pnpm install
      - run: pnpm run bench
      - name: Store benchmark result
        uses: benchmark-action/github-action-benchmark@v1
        with:
          tool: 'vitest'
          output-file-path: benchmark-results.json
```

### æ€§èƒ½å›å½’æ£€æµ‹

è®¾ç½®æ€§èƒ½åŸºçº¿ï¼Œè‡ªåŠ¨æ£€æµ‹å›å½’ï¼š

```typescript
// vitest.config.ts
export default {
  benchmark: {
    threshold: {
      'ä¸­é—´ä»¶ç¼“å­˜': {
        mean: 100, // å¹³å‡ä¸è¶…è¿‡ 100ms
      },
    },
  },
}
```

## ğŸ› ï¸ å¼€å‘å»ºè®®

### ç¼–å†™æ–°çš„åŸºå‡†æµ‹è¯•

```typescript
describe('æ–°åŠŸèƒ½æ€§èƒ½', () => {
  bench('æµ‹è¯•ç”¨ä¾‹åç§°', () => {
    // æµ‹è¯•ä»£ç 
  })
  
  bench('å¼‚æ­¥æµ‹è¯•ç”¨ä¾‹', async () => {
    // å¼‚æ­¥æµ‹è¯•ä»£ç 
  })
})
```

### åŸºå‡†æµ‹è¯•æœ€ä½³å®è·µ

1. **éš”ç¦»æµ‹è¯•** - æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹
2. **é¢„çƒ­** - åœ¨æµ‹é‡å‰è¿è¡Œå‡ æ¬¡é¢„çƒ­
3. **å¤šæ¬¡è¿è¡Œ** - è¿è¡Œè¶³å¤Ÿå¤šçš„è¿­ä»£ä»¥è·å¾—ç¨³å®šç»“æœ
4. **æ¸…ç†** - æµ‹è¯•åæ¸…ç†èµ„æº
5. **çœŸå®åœºæ™¯** - æ¨¡æ‹ŸçœŸå®ä½¿ç”¨åœºæ™¯

## ğŸ“š ç›¸å…³èµ„æº

- [Vitest Benchmark](https://vitest.dev/guide/features.html#benchmarking)
- [Performance Best Practices](https://web.dev/performance/)
- [JavaScript Performance](https://developer.mozilla.org/en-US/docs/Web/Performance)

## ğŸ¤ è´¡çŒ®

å‘ç°æ€§èƒ½é—®é¢˜ï¼Ÿæ¬¢è¿æäº¤ Issue æˆ– PRï¼

è¯·åœ¨ PR ä¸­åŒ…å«ï¼š
- é—®é¢˜æè¿°
- åŸºå‡†æµ‹è¯•ç»“æœå¯¹æ¯”
- ä¼˜åŒ–æ–¹æ¡ˆè¯´æ˜
