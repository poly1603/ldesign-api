{"version":3,"file":"upload.cjs","sources":["../../../../../http/es/utils/upload.js"],"sourcesContent":["class e extends Error{constructor(e,t,i){super(e),this.file=t,this.code=i,this.name=\"FileValidationError\"}}function t(t,a){if(a.accept&&a.accept.length>0){const i=t.type,s=t.name.toLowerCase();if(!a.accept.some(e=>e.startsWith(\".\")?s.endsWith(e.toLowerCase()):!!e.includes(\"/\")&&(i===e||i.startsWith(e.replace(\"*\",\"\")))))throw new e(`文件类型不被允许: ${i}`,t,\"TYPE_NOT_ALLOWED\")}if(a.maxSize&&t.size>a.maxSize)throw new e(`文件大小超出限制: ${i(t.size)} > ${i(a.maxSize)}`,t,\"SIZE_TOO_LARGE\");if(0===t.size)throw new e(\"文件为空\",t,\"INVALID_FILE\")}function i(e){if(0===e)return\"0 B\";const t=Math.floor(Math.log(e)/Math.log(1024));return`${Number.parseFloat((e/1024**t).toFixed(2))} ${[\"B\",\"KB\",\"MB\",\"GB\",\"TB\"][t]}`}function a(e){return e.slice((e.lastIndexOf(\".\")-1>>>0)+2)}async function s(e){const t=await e.arrayBuffer(),i=await crypto.subtle.digest(\"SHA-256\",t);return Array.from(new Uint8Array(i)).map(e=>e.toString(16).padStart(2,\"0\")).join(\"\")}function n(e,t){const i=[],a=Math.ceil(e.size/t);for(let s=0;s<a;s++){const a=s*t,n=Math.min(a+t,e.size),o=e.slice(a,n);i.push({index:s,chunk:o,size:o.size,start:a,end:n,fileHash:\"\"})}return i}function o(e,t,i){const a=new FormData,s=t.fileField||\"file\";return i?(a.append(s,i.chunk,e.name),a.append(\"chunkIndex\",i.index.toString()),a.append(\"totalChunks\",Math.ceil(e.size/(t.chunkSize||e.size)).toString()),a.append(\"fileHash\",i.fileHash)):a.append(s,e),t.formData&&Object.entries(t.formData).forEach(([e,t])=>{a.append(e,t)}),a.append(\"fileName\",e.name),a.append(\"fileSize\",e.size.toString()),a.append(\"fileType\",e.type),a}class r{constructor(){this.startTime=Date.now(),this.lastLoaded=0,this.lastTime=Date.now(),this.speeds=[]}calculate(e,t,i){const a=Date.now(),s=a-this.lastTime,n=e-this.lastLoaded,o=s>0?n/s*1e3:0;this.speeds.push(o),this.speeds.length>10&&this.speeds.shift();const r=this.speeds.reduce((e,t)=>e+t,0)/this.speeds.length,l=r>0?(t-e)/r:0;return this.lastLoaded=e,this.lastTime=a,{loaded:e,total:t,percentage:t>0?Math.round(e/t*100):0,speed:r,timeRemaining:l,elapsed:a-this.startTime,file:i}}reset(){this.startTime=Date.now(),this.lastLoaded=0,this.lastTime=Date.now(),this.speeds=[]}}function l(e){return e.type.startsWith(\"image/\")}function c(e){return e.type.startsWith(\"video/\")}function p(e){return e.type.startsWith(\"audio/\")}function d(e){return[\"application/pdf\",\"application/msword\",\"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\"application/vnd.ms-excel\",\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\"application/vnd.ms-powerpoint\",\"application/vnd.openxmlformats-officedocument.presentationml.presentation\",\"text/plain\",\"text/csv\"].includes(e.type)}function h(e){return URL.createObjectURL(e)}function u(e){URL.revokeObjectURL(e)}export{e as FileValidationError,r as ProgressCalculator,n as createFileChunks,h as createFilePreviewURL,o as createUploadFormData,i as formatFileSize,s as generateFileHash,a as getFileExtension,p as isAudioFile,d as isDocumentFile,l as isImageFile,c as isVideoFile,u as revokeFilePreviewURL,t as validateFile};\n//# sourceMappingURL=upload.js.map\n"],"names":["e","t","i","a","s","n","o","r","l"],"mappings":"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"}