{"version":3,"file":"fetch.cjs","sources":["../../../../../http/es/adapters/fetch.js"],"sourcesContent":["import{isFormData as t,isURLSearchParams as e,isBlob as s,isArrayBuffer as a}from\"../utils/index.js\";import{BaseAdapter as r}from\"./base.js\";class n extends r{constructor(){super(...arguments),this.name=\"fetch\"}isSupported(){return typeof fetch<\"u\"&&typeof AbortController<\"u\"}async request(t){const e=this.processConfig(t);try{const t=this.createTimeoutController(e.timeout),s=this.mergeAbortSignals([e.signal,t.signal]),a={method:e.method,headers:this.buildHeaders(e),signal:s,credentials:e.withCredentials?\"include\":\"same-origin\"};e.data&&\"GET\"!==e.method&&\"HEAD\"!==e.method&&(a.body=this.buildBody(e.data,e.headers));const r=await fetch(e.url,a);return t.cleanup(),await this.handleResponse(r,e)}catch(t){throw this.processError(t,e)}}buildHeaders(s){const a={...s.headers};return s.data&&!a[\"content-type\"]&&!a[\"Content-Type\"]&&(\"string\"==typeof s.data?a[\"Content-Type\"]=\"text/plain\":t(s.data)?delete a[\"Content-Type\"]:e(s.data)?a[\"Content-Type\"]=\"application/x-www-form-urlencoded\":\"object\"==typeof s.data&&(a[\"Content-Type\"]=\"application/json\")),a}buildBody(r,n){if(null!=r){if(\"string\"==typeof r||t(r)||s(r)||a(r)||e(r)||r instanceof ReadableStream)return r;if((n?.[\"content-type\"]||n?.[\"Content-Type\"]||\"\").includes(\"application/x-www-form-urlencoded\")){const t=new URLSearchParams;return Object.keys(r).forEach(e=>{const s=r[e];null!=s&&t.append(e,String(s))}),t}return JSON.stringify(r)}}async handleResponse(t,e){const s=this.parseHeaders(t.headers),a=await this.parseResponseData(t,e.responseType);if(!t.ok)throw this.processError(new Error(`Request failed with status ${t.status}`),e,this.processResponse(a,t.status,t.statusText,s,e,t));return this.processResponse(a,t.status,t.statusText,s,e,t)}async parseResponseData(t,e){if(!t.body)return null;try{switch(e){case\"text\":return await t.text();case\"blob\":return await t.blob();case\"arrayBuffer\":return await t.arrayBuffer();case\"stream\":return t.body;default:{const e=t.headers.get(\"content-type\")||\"\";if(e.includes(\"application/json\"))return await t.json();if(e.includes(\"text/\"))return await t.text();{const e=await t.text();try{return JSON.parse(e)}catch{return e}}}}}catch{return null}}}export{n as FetchAdapter};\n//# sourceMappingURL=fetch.js.map\n"],"names":["r","t","e","s","a","n"],"mappings":"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"}