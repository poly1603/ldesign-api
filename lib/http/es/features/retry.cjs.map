{"version":3,"file":"retry.cjs","sources":["../../../../../http/es/features/retry.js"],"sourcesContent":["const t={maxRetries:3,initialDelay:1e3,maxDelay:3e4,backoffMultiplier:2,enableJitter:!0,shouldRetry:(t,e)=>!!(\"NETWORK_ERROR\"===t.code||\"TIMEOUT\"===t.code||t.response&&t.response.status>=500)};function e(t,e){if(e.delayCalculator)return e.delayCalculator(t,e);let r=e.initialDelay*e.backoffMultiplier**(t-1);return r=Math.min(r,e.maxDelay),e.enableJitter&&(r*=.5+.5*Math.random()),Math.floor(r)}function r(t){return new Promise(e=>setTimeout(e,t))}class a{constructor(e={}){this.config={...t,...e}}async execute(t){const a={attempt:0,totalDelay:0,errors:[],startTime:Date.now()};for(;a.attempt<=this.config?.maxRetries;){a.attempt++;try{return{success:!0,data:await t(),retryState:a}}catch(t){a.errors.push(t);const s=this.config?.shouldRetry?.(t,a.attempt)??!0;if(a.attempt>this.config?.maxRetries||!s)return{success:!1,error:t,retryState:a};const o=e(a.attempt,this.config);a.totalDelay+=o,await r(o)}}return{success:!1,error:a.errors[a.errors.length-1],retryState:a}}updateConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}}function s(t){return new a(t)}function o(t){return function(e,r,a){const o=a.value,n=s(t);return a.value=async function(...t){const e=await n.execute(()=>o.apply(this,t));if(e.success)return e.data;throw e.error},a}}const n=s();async function l(t,e){const r=await(e?s(e):n).execute(t);if(r.success)return r.data;throw r.error}function i(t={}){const e={enabled:t.enabled??!0,maxAttempts:t.maxAttempts??3,delay:t.delay??1e3,backoffMultiplier:t.backoffMultiplier??2,delayFn:t.delayFn,shouldRetry:t.shouldRetry??t.condition??(t=>!!(\"NETWORK_ERROR\"===t.code||\"TIMEOUT\"===t.code||\"NetworkError\"===t.name||t.isNetworkError||t.response?.status>=500&&t.response?.status<600||t.status>=500&&t.status<600))};return async function(t,a){const s=t?.retry||{},o={enabled:s.enabled??e.enabled,maxAttempts:s.maxAttempts??e.maxAttempts,delay:s.delay??e.delay,backoffMultiplier:s.backoffMultiplier??e.backoffMultiplier,delayFn:s.delayFn??e.delayFn,shouldRetry:s.shouldRetry??e.shouldRetry};if(!o.enabled||o.maxAttempts<=0)return a();let n,l=0;for(;l<o.maxAttempts;)try{return l++,await a()}catch(t){n=t;const e=1===o.shouldRetry.length?o.shouldRetry(t):o.shouldRetry(t,l);if(l>=o.maxAttempts||!e)throw t;let a;a=o.delayFn?o.delayFn(l):o.delay*o.backoffMultiplier**(l-1),await r(a)}throw n}}export{t as DEFAULT_RETRY_CONFIG,a as RetryExecutor,e as calculateDelay,s as createRetryExecutor,r as delay,n as globalRetryExecutor,o as retry,l as retryOperation,i as withRetry};\n//# sourceMappingURL=retry.js.map\n"],"names":["t","e","r","a","s","o"],"mappings":"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"}