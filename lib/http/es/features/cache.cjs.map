{"version":3,"file":"cache.cjs","sources":["../../../../../http/es/features/cache.js"],"sourcesContent":["class t{constructor(t=100){this.cache=new Map,this.maxSize=t}async get(t){const e=this.cache.get(t);return e?Date.now()>e.timestamp+1e3*e.ttl?(this.cache.delete(t),null):e:null}async set(t,e){if(this.cache.size>=this.maxSize){const t=this.cache.keys().next().value;t&&this.cache.delete(t)}this.cache.set(t,e)}async delete(t){return this.cache.delete(t)}async clear(){this.cache.clear()}async keys(){return Array.from(this.cache.keys())}async size(){return this.cache.size}}class e{constructor(t=\"http_cache_\"){this.prefix=t}async get(t){try{const e=localStorage.getItem(this.prefix+t);if(!e)return null;const s=JSON.parse(e);return Date.now()>s.timestamp+1e3*s.ttl?(await this.delete(t),null):s}catch{return null}}async set(t,e){try{localStorage.setItem(this.prefix+t,JSON.stringify(e))}catch{await this.cleanup();try{localStorage.setItem(this.prefix+t,JSON.stringify(e))}catch{}}}async delete(t){const e=null!==localStorage.getItem(this.prefix+t);return localStorage.removeItem(this.prefix+t),e}async clear(){(await this.keys()).forEach(t=>localStorage.removeItem(this.prefix+t))}async keys(){const t=[];for(let e=0;e<localStorage.length;e++){const s=localStorage.key(e);s&&s.startsWith(this.prefix)&&t.push(s.substring(this.prefix.length))}return t}async size(){return(await this.keys()).length}async cleanup(){const t=await this.keys(),e=Date.now();for(const s of t){const t=await this.get(s);(!t||e>t.timestamp+1e3*t.ttl)&&await this.delete(s)}}}class s{constructor(t={}){this.stats={hits:0,misses:0,size:0,hitRate:0},this.config={defaultTTL:300,maxSize:100,enableCompression:!1,strategy:\"memory\",...t},this.storage=this.createStorage()}createStorage(){switch(this.config?.strategy){case\"localStorage\":return new e;case\"sessionStorage\":return new e(\"session_http_cache_\");default:return new t(this.config?.maxSize)}}generateKey(t,e){if(this.config?.keyGenerator)return this.config?.keyGenerator(t,e);return`${e.method||\"GET\"}:${t}:${e.params?JSON.stringify(e.params):\"\"}:${e.headers?JSON.stringify(e.headers):\"\"}`}async get(t,e={}){const s=this.generateKey(t,e),a=await this.storage.get(s);return a?(this.stats.hits++,this.updateStats(),a.data):(this.stats.misses++,this.updateStats(),null)}async set(t,e,s,a,r){const i=this.generateKey(t,e),n={data:s,timestamp:Date.now(),ttl:a||this.config?.defaultTTL,headers:r,size:this.calculateSize(s)};await this.storage.set(i,n),this.stats.size=await this.storage.size()}async delete(t,e={}){const s=this.generateKey(t,e),a=await this.storage.delete(s);return this.stats.size=await this.storage.size(),a}async clear(){await this.storage.clear(),this.stats.size=0,this.stats.hits=0,this.stats.misses=0,this.stats.hitRate=0}getStats(){return{...this.stats}}updateStats(){const t=this.stats.hits+this.stats.misses;this.stats.hitRate=t>0?this.stats.hits/t:0}calculateSize(t){try{return JSON.stringify(t).length}catch{return 0}}static isCacheable(t,e,s={}){if(\"GET\"!==t.toUpperCase()||e<200||e>=300)return!1;const a=s[\"cache-control\"]||s[\"Cache-Control\"];return!(a&&(a.includes(\"no-cache\")||a.includes(\"no-store\")))}}function a(t){return new s(t)}function r(e={}){const s={enabled:e.enabled??!0,ttl:e.ttl??3e5,methods:e.methods??[\"GET\"],keyGenerator:e.keyGenerator??(t=>`${t.method||\"GET\"}:${t.url||\"\"}:${t.params?JSON.stringify(t.params):\"\"}`),storage:e.storage??new t};return async function(t,e){const a=t?.cache||{},r={enabled:a.enabled??s.enabled,ttl:a.ttl??s.ttl,methods:a.methods??s.methods,keyGenerator:a.keyGenerator??s.keyGenerator,storage:a.storage??s.storage};if(!r.enabled||!r.methods.includes(t.method||\"GET\"))return e();const i=r.keyGenerator(t);try{const t=await r.storage.get(i);if(t&&Date.now()-t.timestamp<t.ttl)return t.data}catch(t){}const n=await e();if(n&&n.status>=200&&n.status<300)try{await r.storage.set(i,{data:n,timestamp:Date.now(),ttl:r.ttl,size:JSON.stringify(n).length})}catch(t){}return n}}const i=a();export{s as HttpCacheManager,e as LocalStorageCacheStorage,t as MemoryCacheStorage,a as createHttpCacheManager,i as globalHttpCacheManager,r as withCache};\n//# sourceMappingURL=cache.js.map\n"],"names":["t","e","s","a","r","i"],"mappings":"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"}