{"version":3,"file":"network.js","sources":["../../../../../http/es/utils/network.js"],"sourcesContent":["var n,e,t;(e=n||(n={})).ONLINE=\"online\",e.OFFLINE=\"offline\",e.UNKNOWN=\"unknown\",function(n){n.WIFI=\"wifi\",n.CELLULAR_4G=\"4g\",n.CELLULAR_3G=\"3g\",n.CELLULAR_2G=\"2g\",n.UNKNOWN=\"unknown\"}(t||(t={}));class i{constructor(e={}){this.currentStatus=n.UNKNOWN,this.listeners=[],this.isMonitoring=!1,this.config={enabled:e.enabled??!0,pauseOnOffline:e.pauseOnOffline??!0,retryOnOnline:e.retryOnOnline??!0,onStatusChange:e.onStatusChange,onOffline:e.onOffline,onOnline:e.onOnline},this.updateStatus()}start(){if(!this.config?.enabled||this.isMonitoring||typeof window>\"u\")return;this.isMonitoring=!0;const e=()=>{this.handleStatusChange(n.ONLINE),this.config?.onOnline?.()},t=()=>{this.handleStatusChange(n.OFFLINE),this.config?.onOffline?.()};if(window.addEventListener(\"online\",e),window.addEventListener(\"offline\",t),this.listeners.push(()=>window.removeEventListener(\"online\",e),()=>window.removeEventListener(\"offline\",t)),\"connection\"in navigator||\"mozConnection\"in navigator||\"webkitConnection\"in navigator){const n=navigator.connection||navigator.mozConnection||navigator.webkitConnection,e=()=>{this.updateStatus()};n.addEventListener(\"change\",e),this.listeners.push(()=>n.removeEventListener(\"change\",e))}}stop(){this.isMonitoring&&(this.isMonitoring=!1,this.listeners.forEach(n=>n()),this.listeners=[])}getStatus(){return this.currentStatus}isOnline(){return this.currentStatus===n.ONLINE}isOffline(){return this.currentStatus===n.OFFLINE}getNetworkInfo(){const n={online:this.isOnline(),connectionType:t.UNKNOWN,metered:!1};if(typeof navigator>\"u\")return n;const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e&&(e.effectiveType&&(n.effectiveType=e.effectiveType,n.connectionType=this.parseConnectionType(e.effectiveType)),\"boolean\"==typeof e.saveData&&(n.metered=e.saveData),\"number\"==typeof e.downlink&&(n.downlink=e.downlink),\"number\"==typeof e.rtt&&(n.rtt=e.rtt)),n}handleStatusChange(n){if(this.currentStatus===n)return;this.currentStatus=n;const e=this.getNetworkInfo();this.config?.onStatusChange?.(n,e)}updateStatus(){typeof navigator<\"u\"&&\"onLine\"in navigator?this.currentStatus=navigator.onLine?n.ONLINE:n.OFFLINE:this.currentStatus=n.UNKNOWN}parseConnectionType(n){switch(n.toLowerCase()){case\"4g\":return t.CELLULAR_4G;case\"3g\":return t.CELLULAR_3G;case\"2g\":return t.CELLULAR_2G;case\"wifi\":return t.WIFI;default:return t.UNKNOWN}}isSuitableForLargeTransfer(){const n=this.getNetworkInfo();return!(!n.online||n.metered||n.connectionType===t.CELLULAR_2G||n.connectionType===t.CELLULAR_3G||n.downlink&&n.downlink<1)}destroy(){this.stop()}}function o(n){return new i(n)}const r=new i;function s(n){const e=new i(n);e.start();const t=[];return e.start(),{request:{onFulfilled:async n=>{if(e.isOffline()){if(e.config.pauseOnOffline)return new Promise((i,o)=>{t.push({config:n,resolve:i,reject:o});const r=setInterval(()=>{if(e.isOnline()){const n=t.shift();n&&i(n.config)}},1e3);setTimeout(()=>{clearInterval(r);const e=t.findIndex(e=>e.config===n);-1!==e&&(t.splice(e,1),o(new Error(\"Network timeout: request cancelled after 5 minutes\")))},3e5)});throw new Error(\"Network is offline\")}return n}},destroy:()=>{e.destroy()}}}function a(n=6e4){return new Promise((e,t)=>{if(r.isOnline())return void e();const i=setTimeout(()=>{t(new Error(\"Timeout waiting for network\"))},n),o=setInterval(()=>{r.isOnline()&&(clearTimeout(i),e())},1e3);setTimeout(()=>clearInterval(o),n)})}typeof window<\"u\"&&r.start();export{t as ConnectionType,i as NetworkMonitor,n as NetworkStatus,s as createNetworkInterceptor,o as createNetworkMonitor,r as globalNetworkMonitor,a as waitForOnline};\n//# sourceMappingURL=network.js.map\n"],"names":["n","e","t"],"mappings":"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"}