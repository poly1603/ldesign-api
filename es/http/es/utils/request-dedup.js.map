{"version":3,"file":"request-dedup.js","sources":["../../../../../http/es/utils/request-dedup.js"],"sourcesContent":["class e{constructor(e={}){this.keyCache=new WeakMap,this.stringKeyCache=new Map,this.maxCacheSize=1e3,this.config={includeMethod:!0,includeUrl:!0,includeParams:!0,includeData:!1,includeHeaders:!1,specificHeaders:[],customGenerator:e.customGenerator,...e}}generate(e){const t=this.keyCache.get(e);if(t)return t;const r=this.generateKey(e);return this.keyCache.set(e,r),this.cacheStringKey(r),r}generateKey(e){if(this.config?.customGenerator)return this.config?.customGenerator(e);const t=[];if(this.config?.includeMethod&&e.method&&t.push(`method:${e.method.toUpperCase()}`),this.config?.includeUrl&&e.url&&t.push(`url:${e.url}`),this.config?.includeParams&&e.params){const r=this.serializeParams(e.params);r&&t.push(`params:${r}`)}if(this.config?.includeData&&e.data){const r=this.serializeData(e.data);r&&t.push(`data:${r}`)}if(this.config?.includeHeaders&&e.headers){const r=this.serializeHeaders(e.headers);r&&t.push(`headers:${r}`)}if(this.config?.specificHeaders.length>0&&e.headers){const r=this.serializeSpecificHeaders(e.headers,this.config?.specificHeaders);r&&t.push(`specific-headers:${r}`)}return t.join(\"|\")}cacheStringKey(e){if(this.stringKeyCache.size>=this.maxCacheSize){const e=this.stringKeyCache.keys().next().value;void 0!==e&&this.stringKeyCache.delete(e)}this.stringKeyCache.set(e,e)}clearCache(){this.stringKeyCache.clear()}serializeParams(e){try{const t=Object.keys(e).sort(),r=t.length;if(0===r)return\"\";const s=Array.from({length:r},()=>\"\");for(let i=0;i<r;i++){const r=t[i];s[i]=`${r}:${JSON.stringify(e[r])}`}return s.join(\",\")}catch{return String(e)}}serializeData(e){try{if(e instanceof FormData){const t=[];for(const[r,s]of e.entries())t.push(`${r}:${\"string\"==typeof s?s:\"[File]\"}`);return t.sort().join(\",\")}if(\"object\"==typeof e&&null!==e){const t=Object.keys(e).sort(),r=[];for(const s of t)r.push(`${s}:${JSON.stringify(e[s])}`);return r.join(\",\")}return String(e)}catch{return String(e)}}serializeHeaders(e){try{const t=new Set([\"authorization\",\"x-request-id\",\"x-timestamp\"]),r=[],s=Object.keys(e).sort();for(const i of s)t.has(i.toLowerCase())||r.push(`${i}:${e[i]}`);return r.join(\",\")}catch{return String(e)}}serializeSpecificHeaders(e,t){try{const r=[],s=[...t].sort();for(const t of s)void 0!==e[t]&&r.push(`${t}:${e[t]}`);return r.join(\",\")}catch{return\"\"}}}function t(t){return new e(t)}const r=new e;function s(e){return r.generate(e)}export{e as DeduplicationKeyGenerator,t as createDeduplicationKeyGenerator,r as defaultKeyGenerator,s as generateRequestKey};\n//# sourceMappingURL=request-dedup.js.map\n"],"names":["e","t","r","s"],"mappings":"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"}