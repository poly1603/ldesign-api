{"version":3,"file":"memory.js","sources":["../../../../../http/es/utils/memory.js"],"sourcesContent":["import e from\"node:process\";class t{constructor(e={}){this.usageHistory=[],this.stats={current:{used:0,total:0,percentage:0,timestamp:Date.now()},peak:{used:0,total:0,percentage:0,timestamp:Date.now()},average:0,warningCount:0,dangerCount:0,cleanupCount:0},this.config={enabled:e.enabled??!0,interval:e.interval??1e4,warningThreshold:e.warningThreshold??100,dangerThreshold:e.dangerThreshold??200,autoCleanup:e.autoCleanup??!0,onCleanup:e.onCleanup,onWarning:e.onWarning,onDanger:e.onDanger},this.config?.enabled&&this.start()}start(){this.monitorTimer||(this.monitorTimer=setInterval(()=>{this.check()},this.config?.interval),this.check())}stop(){this.monitorTimer&&(clearInterval(this.monitorTimer),this.monitorTimer=void 0)}check(){const e=this.getMemoryUsage();this.stats.current=e,e.used>this.stats.peak.used&&(this.stats.peak=e),this.usageHistory.push(e),this.usageHistory.length>100&&this.usageHistory.shift(),this.stats.average=this.usageHistory.reduce((e,t)=>e+t.used,0)/this.usageHistory.length,e.used>=this.config?.dangerThreshold?(this.stats.dangerCount++,this.config?.onDanger?.(e),this.config?.autoCleanup&&this.cleanup()):e.used>=this.config?.warningThreshold&&(this.stats.warningCount++,this.config?.onWarning?.(e))}getMemoryUsage(){let t=0,s=0;if(typeof performance<\"u\"&&performance.memory){const e=performance.memory;t=e.usedJSHeapSize/1024/1024,s=e.totalJSHeapSize/1024/1024}else if(typeof e<\"u\"&&e.memoryUsage){const a=e.memoryUsage();t=a.heapUsed/1024/1024,s=a.heapTotal/1024/1024}return{used:t,total:s,percentage:s>0?t/s*100:0,timestamp:Date.now()}}cleanup(){if(this.stats.cleanupCount++,this.config?.onCleanup?.(),typeof globalThis<\"u\"&&globalThis.gc)try{globalThis.gc()}catch{}}getStats(){return{...this.stats}}getHistory(){return[...this.usageHistory]}resetStats(){this.stats={current:this.stats.current,peak:{used:0,total:0,percentage:0,timestamp:Date.now()},average:0,warningCount:0,dangerCount:0,cleanupCount:0},this.usageHistory=[]}destroy(){this.stop(),this.usageHistory=[]}}function s(e){return new t(e)}const a=s({enabled:!1});class n{constructor(){this.cleanupHandlers=[]}register(e){return this.cleanupHandlers.push(e),()=>{const t=this.cleanupHandlers.indexOf(e);t>-1&&this.cleanupHandlers.splice(t,1)}}cleanup(){this.cleanupHandlers.forEach(e=>{try{e()}catch(e){}})}clear(){this.cleanupHandlers=[]}}const r=new n;export{n as MemoryCleaner,t as MemoryMonitor,s as createMemoryMonitor,r as globalMemoryCleaner,a as globalMemoryMonitor};\n//# sourceMappingURL=memory.js.map\n"],"names":["e","t","s","a"],"mappings":"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"}