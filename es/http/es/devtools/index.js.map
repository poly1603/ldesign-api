{"version":3,"file":"index.js","sources":["../../../../../http/es/devtools/index.js"],"sourcesContent":["import e from\"node:process\";import{logger as t}from\"../utils/logger.js\";class o{constructor(t={}){this.records=[],this.client=null,this.interceptorIds=null,this.config={enabled:t.enabled??\"production\"!==e.env.NODE_ENV,maxRecords:t.maxRecords??100,showConsole:t.showConsole??!0,logToConsole:t.logToConsole??!0,performanceThreshold:t.performanceThreshold??1e3},typeof window<\"u\"&&this.config?.enabled&&(window.__HTTP_DEVTOOLS__=this)}attach(e){if(!this.config?.enabled||this.client)return;this.client=e;const o=e.addRequestInterceptor(e=>(this.onRequestStart(e),e)),s=e.addResponseInterceptor(e=>(this.onRequestSuccess(e),e),e=>{throw this.onRequestError(e),e});this.interceptorIds={request:o,response:s,error:-1},this.config?.logToConsole&&t.info(\"DevTools attached to HTTP client\")}detach(){!this.client||!this.interceptorIds||(this.client.removeRequestInterceptor(this.interceptorIds.request),this.client.removeResponseInterceptor(this.interceptorIds.response),this.client=null,this.interceptorIds=null,this.config?.logToConsole&&t.info(\"DevTools detached from HTTP client\"))}onRequestStart(e){const o=this.generateId(),s={id:o,timestamp:Date.now(),config:e,status:\"pending\"};e.__devtools_id__=o,this.addRecord(s),this.config?.logToConsole&&(t.group(`➡️ ${e.method?.toUpperCase()} ${e.url}`),t.debug(\"Config:\",e),t.groupEnd())}onRequestSuccess(e){const o=e.config.__devtools_id__;if(!o)return;const s=this.findRecord(o);if(s&&(s.duration=Date.now()-s.timestamp,s.response=e,s.status=\"success\",this.config?.logToConsole)){const o=s.duration>this.config?.performanceThreshold,r=o?\"🐌\":\"✅\";t.group(`${r} ${e.config.method?.toUpperCase()} ${e.config.url} (${s.duration}ms)`),t.debug(\"Status:\",e.status),t.debug(\"Data:\",e.data),o&&t.warn(`慢请求警告: 耗时 ${s.duration}ms`),t.groupEnd()}}onRequestError(e){const o=e.config.__devtools_id__;if(!o)return;const s=this.findRecord(o);s&&(s.duration=Date.now()-s.timestamp,s.error=e,s.status=\"error\",this.config?.logToConsole&&(t.group(`❌ ${e.config?.method?.toUpperCase()} ${e.config?.url} (${s.duration}ms)`),t.error(\"Error:\",e.message),t.error(\"Details:\",e),t.groupEnd()))}addRecord(e){this.records.unshift(e),this.records.length>this.config?.maxRecords&&(this.records=this.records.slice(0,this.config?.maxRecords))}findRecord(e){return this.records.find(t=>t.id===e)}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}getRecords(){return[...this.records]}getFailedRequests(){return this.records.filter(e=>\"error\"===e.status)}getSlowRequests(){return this.records.filter(e=>e.duration&&e.duration>this.config?.performanceThreshold)}getStats(){const e={total:this.records.length,pending:0,success:0,error:0,cancelled:0,averageDuration:0,slowRequests:0};let t=0,o=0;return this.records.forEach(s=>{e[s.status]++,s.duration&&(t+=s.duration,o++,s.duration>this.config?.performanceThreshold&&e.slowRequests++)}),o>0&&(e.averageDuration=Math.round(t/o)),e}clear(){this.records=[],this.config?.logToConsole&&t.info(\"DevTools records cleared\")}export(){const e={records:this.records,stats:this.getStats(),exportedAt:(new Date).toISOString()};return JSON.stringify(e,null,2)}download(){if(typeof window>\"u\")return void t.warn(\"Download is only available in browser\");const e=this.export(),o=new Blob([e],{type:\"application/json\"}),s=URL.createObjectURL(o),r=document.createElement(\"a\");r.href=s,r.download=`http-devtools-${Date.now()}.json`,r.click(),URL.revokeObjectURL(s),t.info(\"DevTools data exported\")}printStats(){this.getStats()}}function s(e){return new o(e)}const r=new o;typeof window<\"u\"&&(window.httpDevTools={getRecords:()=>r.getRecords(),getStats:()=>r.getStats(),printStats:()=>r.printStats(),clear:()=>r.clear(),export:()=>r.download()});export{o as HttpDevTools,s as createDevTools,r as globalDevTools};\n//# sourceMappingURL=index.js.map\n"],"names":["t","e","o","s","r"],"mappings":";;;;;;;;;;;;AAAwE,MAAM,CAAA,CAAC;AAAA,EAAC,WAAA,CAAYA,EAAAA,GAAE,EAAC,EAAE;AAAC,IAAA,IAAA,CAAK,UAAQ,EAAC,EAAE,KAAK,MAAA,GAAO,IAAA,EAAK,KAAK,cAAA,GAAe,IAAA,EAAK,KAAK,MAAA,GAAO,EAAC,SAAQA,EAAAA,CAAE,OAAA,IAAS,iBAAe,CAAA,CAAE,GAAA,CAAI,UAAS,UAAA,EAAWA,EAAAA,CAAE,cAAY,GAAA,EAAI,WAAA,EAAYA,GAAE,WAAA,IAAa,IAAA,EAAG,cAAaA,EAAAA,CAAE,YAAA,IAAc,MAAG,oBAAA,EAAqBA,EAAAA,CAAE,wBAAsB,GAAA,EAAG,EAAE,OAAO,MAAA,GAAO,GAAA,IAAK,KAAK,MAAA,EAAQ,OAAA,KAAU,OAAO,iBAAA,GAAkB,IAAA,CAAA;AAAA,EAAK;AAAA,EAAC,OAAOC,EAAAA,EAAE;AAAC,IAAA,IAAG,CAAC,IAAA,CAAK,MAAA,EAAQ,OAAA,IAAS,KAAK,MAAA,EAAO;AAAO,IAAA,IAAA,CAAK,MAAA,GAAOA,EAAAA;AAAE,IAAA,MAAMC,EAAAA,GAAED,GAAE,qBAAA,CAAsB,CAAAA,QAAI,IAAA,CAAK,cAAA,CAAeA,EAAC,CAAA,EAAEA,EAAAA,CAAE,CAAA,EAAEE,KAAEF,EAAAA,CAAE,sBAAA,CAAuB,CAAAA,EAAAA,MAAI,IAAA,CAAK,iBAAiBA,EAAC,CAAA,EAAEA,EAAAA,CAAAA,EAAG,CAAAA,EAAAA,KAAG;AAAC,MAAA,MAAM,IAAA,CAAK,cAAA,CAAeA,EAAC,CAAA,EAAEA,EAAAA;AAAA,IAAC,CAAC,CAAA;AAAE,IAAA,IAAA,CAAK,cAAA,GAAe,EAAC,OAAA,EAAQC,EAAAA,EAAE,UAASC,EAAAA,EAAE,KAAA,EAAM,EAAA,EAAE,EAAE,IAAA,CAAK,MAAA,EAAQ,YAAA,IAAc,CAAA,CAAE,KAAK,kCAAkC,CAAA;AAAA,EAAC;AAAA,EAAC,MAAA,GAAQ;AAAC,IAAA,CAAC,IAAA,CAAK,MAAA,IAAQ,CAAC,IAAA,CAAK,cAAA,KAAiB,IAAA,CAAK,MAAA,CAAO,wBAAA,CAAyB,IAAA,CAAK,cAAA,CAAe,OAAO,CAAA,EAAE,KAAK,MAAA,CAAO,yBAAA,CAA0B,IAAA,CAAK,cAAA,CAAe,QAAQ,CAAA,EAAE,IAAA,CAAK,MAAA,GAAO,IAAA,EAAK,IAAA,CAAK,cAAA,GAAe,IAAA,EAAK,IAAA,CAAK,MAAA,EAAQ,YAAA,IAAc,CAAA,CAAE,KAAK,oCAAoC,CAAA,CAAA;AAAA,EAAE;AAAA,EAAC,eAAeF,EAAAA,EAAE;AAAC,IAAA,MAAMC,EAAAA,GAAE,IAAA,CAAK,UAAA,EAAW,EAAEC,KAAE,EAAC,EAAA,EAAGD,EAAAA,EAAE,SAAA,EAAU,KAAK,GAAA,EAAI,EAAE,MAAA,EAAOD,EAAAA,EAAE,QAAO,SAAA,EAAS;AAAE,IAAAA,EAAAA,CAAE,eAAA,GAAgBC,EAAAA,EAAE,IAAA,CAAK,SAAA,CAAUC,EAAC,CAAA,EAAE,IAAA,CAAK,MAAA,EAAQ,YAAA,KAAe,CAAA,CAAE,KAAA,CAAM,CAAA,aAAA,EAAMF,EAAAA,CAAE,MAAA,EAAQ,WAAA,EAAa,CAAA,CAAA,EAAIA,EAAAA,CAAE,GAAG,CAAA,CAAE,CAAA,EAAE,CAAA,CAAE,KAAA,CAAM,SAAA,EAAUA,EAAC,CAAA,EAAE,CAAA,CAAE,QAAA,EAAS,CAAA;AAAA,EAAE;AAAA,EAAC,iBAAiBA,EAAAA,EAAE;AAAC,IAAA,MAAMC,EAAAA,GAAED,GAAE,MAAA,CAAO,eAAA;AAAgB,IAAA,IAAG,CAACC,EAAAA,EAAE;AAAO,IAAA,MAAMC,EAAAA,GAAE,IAAA,CAAK,UAAA,CAAWD,EAAC,CAAA;AAAE,IAAA,IAAGC,OAAIA,EAAAA,CAAE,QAAA,GAAS,IAAA,CAAK,GAAA,KAAMA,EAAAA,CAAE,SAAA,EAAUA,EAAAA,CAAE,QAAA,GAASF,IAAEE,EAAAA,CAAE,MAAA,GAAO,SAAA,EAAU,IAAA,CAAK,QAAQ,YAAA,CAAA,EAAc;AAAC,MAAA,MAAMD,EAAAA,GAAEC,GAAE,QAAA,GAAS,IAAA,CAAK,QAAQ,oBAAA,EAAqBC,EAAAA,GAAEF,KAAE,WAAA,GAAK,QAAA;AAAI,MAAA,CAAA,CAAE,MAAM,CAAA,EAAGE,EAAC,CAAA,CAAA,EAAIH,EAAAA,CAAE,OAAO,MAAA,EAAQ,WAAA,EAAa,CAAA,CAAA,EAAIA,GAAE,MAAA,CAAO,GAAG,KAAKE,EAAAA,CAAE,QAAQ,KAAK,CAAA,EAAE,CAAA,CAAE,KAAA,CAAM,SAAA,EAAUF,GAAE,MAAM,CAAA,EAAE,EAAE,KAAA,CAAM,OAAA,EAAQA,GAAE,IAAI,CAAA,EAAEC,EAAAA,IAAG,CAAA,CAAE,KAAK,CAAA,6CAAA,EAAaC,EAAAA,CAAE,QAAQ,CAAA,EAAA,CAAI,CAAA,EAAE,EAAE,QAAA,EAAS;AAAA,IAAC;AAAA,EAAC;AAAA,EAAC,eAAeF,EAAAA,EAAE;AAAC,IAAA,MAAMC,EAAAA,GAAED,GAAE,MAAA,CAAO,eAAA;AAAgB,IAAA,IAAG,CAACC,EAAAA,EAAE;AAAO,IAAA,MAAMC,EAAAA,GAAE,IAAA,CAAK,UAAA,CAAWD,EAAC,CAAA;AAAE,IAAAC,EAAAA,KAAIA,GAAE,QAAA,GAAS,IAAA,CAAK,KAAI,GAAEA,EAAAA,CAAE,WAAUA,EAAAA,CAAE,KAAA,GAAMF,IAAEE,EAAAA,CAAE,MAAA,GAAO,SAAQ,IAAA,CAAK,MAAA,EAAQ,iBAAe,CAAA,CAAE,KAAA,CAAM,CAAA,OAAA,EAAKF,EAAAA,CAAE,MAAA,EAAQ,MAAA,EAAQ,aAAa,CAAA,CAAA,EAAIA,GAAE,MAAA,EAAQ,GAAG,KAAKE,EAAAA,CAAE,QAAQ,KAAK,CAAA,EAAE,CAAA,CAAE,MAAM,QAAA,EAASF,EAAAA,CAAE,OAAO,CAAA,EAAE,CAAA,CAAE,MAAM,UAAA,EAAWA,EAAC,CAAA,EAAE,CAAA,CAAE,QAAA,EAAS,CAAA,CAAA;AAAA,EAAG;AAAA,EAAC,UAAUA,EAAAA,EAAE;AAAC,IAAA,IAAA,CAAK,QAAQ,OAAA,CAAQA,EAAC,GAAE,IAAA,CAAK,OAAA,CAAQ,SAAO,IAAA,CAAK,MAAA,EAAQ,UAAA,KAAa,IAAA,CAAK,UAAQ,IAAA,CAAK,OAAA,CAAQ,MAAM,CAAA,EAAE,IAAA,CAAK,QAAQ,UAAU,CAAA,CAAA;AAAA,EAAE;AAAA,EAAC,WAAWA,EAAAA,EAAE;AAAC,IAAA,OAAO,KAAK,OAAA,CAAQ,IAAA,CAAK,CAAAD,EAAAA,KAAGA,EAAAA,CAAE,OAAKC,EAAC,CAAA;AAAA,EAAC;AAAA,EAAC,UAAA,GAAY;AAAC,IAAA,OAAM,CAAA,EAAG,IAAA,CAAK,GAAA,EAAK,IAAI,IAAA,CAAK,MAAA,EAAO,CAAE,QAAA,CAAS,EAAE,CAAA,CAAE,MAAA,CAAO,CAAA,EAAE,CAAC,CAAC,CAAA,CAAA;AAAA,EAAE;AAAA,EAAC,UAAA,GAAY;AAAC,IAAA,OAAM,CAAC,GAAG,IAAA,CAAK,OAAO,CAAA;AAAA,EAAC;AAAA,EAAC,iBAAA,GAAmB;AAAC,IAAA,OAAO,KAAK,OAAA,CAAQ,MAAA,CAAO,CAAAA,EAAAA,KAAG,OAAA,KAAUA,GAAE,MAAM,CAAA;AAAA,EAAC;AAAA,EAAC,eAAA,GAAiB;AAAC,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,MAAA,CAAO,CAAAA,EAAAA,KAAGA,EAAAA,CAAE,QAAA,IAAUA,EAAAA,CAAE,QAAA,GAAS,IAAA,CAAK,MAAA,EAAQ,oBAAoB,CAAA;AAAA,EAAC;AAAA,EAAC,QAAA,GAAU;AAAC,IAAA,MAAMA,KAAE,EAAC,KAAA,EAAM,IAAA,CAAK,OAAA,CAAQ,QAAO,OAAA,EAAQ,CAAA,EAAE,OAAA,EAAQ,CAAA,EAAE,OAAM,CAAA,EAAE,SAAA,EAAU,GAAE,eAAA,EAAgB,CAAA,EAAE,cAAa,CAAA,EAAC;AAAE,IAAA,IAAID,EAAAA,GAAE,GAAEE,EAAAA,GAAE,CAAA;AAAE,IAAA,OAAO,IAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,CAAAC,EAAAA,KAAG;AAAC,MAAAF,EAAAA,CAAEE,EAAAA,CAAE,MAAM,CAAA,EAAA,EAAIA,GAAE,QAAA,KAAWH,EAAAA,IAAGG,EAAAA,CAAE,QAAA,EAASD,MAAIC,EAAAA,CAAE,QAAA,GAAS,IAAA,CAAK,MAAA,EAAQ,wBAAsBF,EAAAA,CAAE,YAAA,EAAA,CAAA;AAAA,IAAe,CAAC,CAAA,EAAEC,EAAAA,GAAE,CAAA,KAAID,EAAAA,CAAE,kBAAgB,IAAA,CAAK,KAAA,CAAMD,EAAAA,GAAEE,EAAC,CAAA,CAAA,EAAGD,EAAAA;AAAA,EAAC;AAAA,EAAC,KAAA,GAAO;AAAC,IAAA,IAAA,CAAK,OAAA,GAAQ,EAAC,EAAE,IAAA,CAAK,QAAQ,YAAA,IAAc,CAAA,CAAE,KAAK,0BAA0B,CAAA;AAAA,EAAC;AAAA,EAAC,MAAA,GAAQ;AAAC,IAAA,MAAMA,EAAAA,GAAE,EAAC,OAAA,EAAQ,IAAA,CAAK,OAAA,EAAQ,KAAA,EAAM,IAAA,CAAK,QAAA,EAAS,EAAE,UAAA,EAAA,iBAAY,IAAI,IAAA,EAAA,EAAM,aAAY,EAAC;AAAE,IAAA,OAAO,IAAA,CAAK,SAAA,CAAUA,EAAAA,EAAE,IAAA,EAAK,CAAC,CAAA;AAAA,EAAC;AAAA,EAAC,QAAA,GAAU;AAAC,IAAA,IAAG,OAAO,MAAA,GAAO,GAAA,SAAW,KAAK,CAAA,CAAE,KAAK,uCAAuC,CAAA;AAAE,IAAA,MAAMA,EAAAA,GAAE,KAAK,MAAA,EAAO,EAAEC,KAAE,IAAI,IAAA,CAAK,CAACD,EAAC,CAAA,EAAE,EAAC,MAAK,kBAAA,EAAmB,CAAA,EAAEE,EAAAA,GAAE,GAAA,CAAI,eAAA,CAAgBD,EAAC,CAAA,EAAEE,EAAAA,GAAE,QAAA,CAAS,aAAA,CAAc,GAAG,CAAA;AAAE,IAAAA,GAAE,IAAA,GAAKD,EAAAA,EAAEC,GAAE,QAAA,GAAS,CAAA,cAAA,EAAiB,KAAK,GAAA,EAAK,SAAQA,EAAAA,CAAE,KAAA,IAAQ,GAAA,CAAI,eAAA,CAAgBD,EAAC,CAAA,EAAE,CAAA,CAAE,KAAK,wBAAwB,CAAA;AAAA,EAAC;AAAA,EAAC,UAAA,GAAY;AAAC,IAAA,IAAA,CAAK,QAAA,EAAS;AAAA,EAAC;AAAC;AAA+B,MAAM,IAAE,IAAI,CAAA;AAAE,OAAO,MAAA,GAAO,GAAA,KAAM,MAAA,CAAO,YAAA,GAAa,EAAC,UAAA,EAAW,MAAI,CAAA,CAAE,UAAA,EAAW,EAAE,QAAA,EAAS,MAAI,CAAA,CAAE,QAAA,EAAS,EAAE,UAAA,EAAW,MAAI,CAAA,CAAE,UAAA,EAAW,EAAE,KAAA,EAAM,MAAI,CAAA,CAAE,KAAA,EAAM,EAAE,MAAA,EAAO,MAAI,CAAA,CAAE,UAAS,EAAC,CAAA;;;;;;;"}